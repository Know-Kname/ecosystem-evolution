# Device-Wide WSL Configuration Template
# Source of Truth for Device Ecosystem Manager
#
# Placeholders (replaced at sync time):
#   {{MEMORY}}      - Calculated based on system RAM
#   {{PROCESSORS}}  - Calculated based on logical CPUs
#   {{HOSTNAME}}    - Machine hostname
#   {{TIMESTAMP}}   - When config was applied
#
# This file is the canonical configuration. All machines and profiles
# should sync from this template.
#
# Updated: 2025-12-25 with Windows 11 22H2+ best practices
# References:
#   - https://learn.microsoft.com/en-us/windows/wsl/wsl-config
#   - https://devblogs.microsoft.com/commandline/windows-subsystem-for-linux-september-2023-update/

[wsl2]
# Memory allocation - dynamically calculated per machine
# Formula: min(max(2GB, 50% of RAM), 16GB)
memory={{MEMORY}}GB

# Processor allocation - dynamically calculated per machine
# Formula: max(2, 80% of logical processors)
processors={{PROCESSORS}}

# Swap file size (fixed across all machines)
swap=4GB

# Enable localhost forwarding (REQUIRED for Docker, dev servers)
localhostForwarding=true

# DNS tunneling (improves VPN compatibility and complex network setups)
dnsTunneling=true

# Auto proxy (WSL automatically sets HTTP_PROXY environment variables)
# Enables seamless proxy integration from Windows
autoProxy=true

# Mirrored networking mode (Windows 11 22H2+)
# Mirrors Windows network interfaces into Linux for better compatibility
# Benefits: Bidirectional localhost, improved VPN support, IPv6 support
# NOTE: Comment out if running older Windows 11 versions
networkingMode=mirrored

# Firewall (enable for better security)
firewall=true

# Nested virtualization (disable for stability)
nestedVirtualization=false

# GUI support (WSLg for running Linux GUI applications)
guiApplications=true

# Safe mode (disable unless troubleshooting)
safeMode=false

# Debug console
debugConsole=false

[experimental]
# Sparse VHD (automatically shrinks WSL virtual hard disk as you use it)
# Reduces disk space usage and prevents VHD bloat
sparseVhd=true

# Auto memory reclaim (returns unused memory to Windows after CPU idling)
# Options: 'gradual' (slow release over 30min) or 'dropcache' (instant release)
# NOTE: 'gradual' may cause Docker daemon issues - use Docker Desktop instead
# Reference: https://devblogs.microsoft.com/commandline/windows-subsystem-for-linux-september-2023-update/
autoMemoryReclaim=gradual

# Host address loopback (improved localhost networking)
# Enables Linux to connect to Windows services via localhost
hostAddressLoopback=true

